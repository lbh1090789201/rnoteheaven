<% provide :title, "基本信息" %>
<% provide :content, "保存" %>

<div class="edit_basic" id="user-edit">
    <%= simple_form_for @user, url: webapp_user_path(current_user.id),remote: true, :method => :patch, class: "user-form" do |f| %>
      <div class="job-pubilc">
        <%= f.input :show_name, label: "姓        名", input_html: { class: "user-input", id: "user_name", name: "show_name"} %>
        <span class="empty-cont" onclick="EmptyCont('user_name')"></span>
      </div>
      <%= f.input :sex, label: '性        别', input_html: { readonly: "readonly", class: "user-sex user-input user-public", id: "sex", name: "sex"} %>
      <%= f.input :highest_degree, label: '最高学历', input_html: { readonly: "readonly", class: "highest-degree user-input", id: "highest_degree", name: "highest_degree"} %>
      <!-- 职称属性 -->
      <%= f.input :position, label: '职        称', input_html: { readonly: "readonly", class: "user-title user-input", id: "user_title", name: "position"} %>
      <%= f.input :start_work_at, label: '工作年限', as: :string, input_html: { readonly: "readonly", class: "start-work user-input user-public", id: "start_work", name: "start_work_at"} %>
      <%= f.input :birthday, label: '出生年月', as: :string, input_html: { class: "user-input", id: "birthday", name: "birthday"} %>
      <div class="job-pubilc">
        <%= f.input :cellphone, label: '手机号码', input_html: { class: "user-input", id: "user_phone", name: "cellphone", name: "cellphone"} %>
        <span class="empty-cont" onclick="EmptyCont('user_phone')"></span>
      </div>
      <div class="job-pubilc">
        <%= f.input :user_email, label: '邮        箱', input_html: { class: "user-input", id: "user_email", name: "user_email", name: "user_email"} %>
        <span class="empty-cont" onclick="EmptyCont('user_email')"></span>
      </div>
      <%= f.input :location, label: '所在区域', input_html: { readonly: "readonly", class: "user-input", id: "locationChoice", name: "location"} %>
      <!-- 城市插件需要用到 -->
      <input type="hidden" id="province" value="">
      <input type="hidden" id="city" value="">
      <!-- 当前状态属性 -->
      <%= f.input :seeking_job, label: '当前状态', input_html: { readonly: "readonly", class: "seeking-job user-input", id: "seeking_job", name: "seeking_job"} %>
      <%= f.submit "保存", id: "submit", style: "display: none" %>
      <button type="button" name="button" id="btn_save" class="btn btn-info btn-right">保存</button>
    <% end %>
    <!-- 时间代码生成处 -->
　　　<div id="datePlugin"></div>
</div>

<%= javascript_include_tag "date" %>
<script type="text/javascript">
  fullScreen('.edit_basic');
  // 表单验证
  formAll("form");

  // 防重复点击
  $("#btn_save").on('click',function() {
    EditMask("#btn_save", "请完善信息！");
    // 表单验证失败返回
    if(valid('form')){
      return
    }
    $("#btn_save").css("pointer-events","none");
    $(':submit').trigger('click');
  })

  // 返回顶部
  $("#locationChoice").bind('click',function(){
    var height = $('body').height();
    var timer = setTimeout(function(){$('body').scrollTop(height)},1)
  })

  var start = {
      dateCell: '#birthday',
      format: 'YYYY-MM-DD',
      minDate: '1900-01-01', //设定最小日期为当前日期
      maxDate: jeDate.now(0),
      ishmsVal:false,
      // maxDate: '2099-06-30', //最大日期
  };
  jeDate(start);

　　//性别
    $('.user-sex').click(function() {
        this.blur()
        var sex = ['男','女'];
        addComponent("#wrap", sex, '#sex')
    });

　　　//最高学历
    $('.highest-degree').click(function() {
      this.blur()
      var highest_degree = ['大专以下', '大专','本科', '硕士', '博士', '博士后'];
      addComponent("#wrap", highest_degree, '#highest_degree')
    });

　　　//职称
    $('.user-title').click(function() {
      this.blur()
      var user_title = ['医师','主治医师', '副主任医师', '主任医师'];
      addComponent("#wrap", user_title, '#user_title', true);
    });

    //工作年限
    $('.start-work').click(function() {
      this.blur()
      var start_work = ['在读','应届', '1年', '２年', '3-4年', '5-7年', '8-9年', '10年以上'];
      addComponent("#wrap", start_work, '#start_work')
    });

    //当前状态
    $('.seeking-job').click(function() {
      this.blur()
      var seeking_job = ['在职, 看看新机会','离职, 正在找工作', '在职, 急寻新工作', '在职, 暂无跳槽打算', '暂无跳槽打算'];
      addComponent("#wrap", seeking_job, '#seeking_job')
    });

    // 城市插件再次点击删掉原来的
    $("#locationChoice").on('click', function() {
      this.blur()
      againClick();
    })

      // 城市插件
      var cityPicker = new IIInsomniaCityPicker({
            data: cityData,
            target: '#locationChoice',
            valType: 'k-v',
            hideCityInput: '#city',
            hideProvinceInput: '#province',
            callback: function(){
              $("#locationChoice").blur();
            }
        });

        cityPicker.init();
</script>
